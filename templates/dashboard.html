<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Legal Document Demystifier</title>
  <script>
  const userLanguage = "{{ language }}";
  const translations = {
    "English": {
      "agents": "ğŸ§© Agents",
      "summarizer": "ğŸ§  Summarizer",
      "jargons": "ğŸ“˜ Legal Terms & Jargons",
      "timeline": "ğŸ•’ Case Timeline",
      "graph": "ğŸ“Š Case Relationship Graph",
      "thinker": "ğŸ’­ Thinker (Chat Agent)"
    },
    "Hindi": {
      "agents": "ğŸ§© à¤à¤œà¥‡à¤‚à¤Ÿà¥à¤¸",
      "summarizer": "ğŸ§  à¤¸à¤¾à¤°à¤¾à¤‚à¤¶",
      "jargons": "ğŸ“˜ à¤•à¤¾à¤¨à¥‚à¤¨à¥€ à¤¶à¤¬à¥à¤¦à¤¾à¤µà¤²à¥€",
      "timeline": "ğŸ•’ à¤®à¥à¤•à¤¦à¤®à¥‡ à¤•à¥€ à¤¸à¤®à¤¯à¤°à¥‡à¤–à¤¾",
      "graph": "ğŸ“Š à¤®à¤¾à¤®à¤²à¤¾ à¤¸à¤‚à¤¬à¤‚à¤§ à¤—à¥à¤°à¤¾à¤«",
      "thinker": "ğŸ’­ à¤µà¤¿à¤šà¤¾à¤°à¤• (à¤šà¥ˆà¤Ÿ à¤¸à¤¹à¤¾à¤¯à¤•)"
    },
    "Bengali": {
      "agents": "ğŸ§© à¦à¦œà§‡à¦¨à§à¦Ÿà¦¸",
      "summarizer": "ğŸ§  à¦¸à¦¾à¦°à¦¸à¦‚à¦•à§à¦·à§‡à¦ª",
      "jargons": "ğŸ“˜ à¦†à¦‡à¦¨à¦¿ à¦¶à¦¬à§à¦¦à¦­à¦¾à¦¨à§à¦¡à¦¾à¦°",
      "timeline": "ğŸ•’ à¦®à¦¾à¦®à¦²à¦¾à¦° à¦Ÿà¦¾à¦‡à¦®à¦²à¦¾à¦‡à¦¨",
      "graph": "ğŸ“Š à¦®à¦¾à¦®à¦²à¦¾à¦° à¦¸à¦®à§à¦ªà¦°à§à¦• à¦—à§à¦°à¦¾à¦«",
      "thinker": "ğŸ’­ à¦šà¦¿à¦¨à§à¦¤à¦¾à¦¶à§€à¦² (à¦šà§à¦¯à¦¾à¦Ÿ à¦¸à¦¹à¦•à¦¾à¦°à§€)"
    },
    "Marathi": {
      "agents": "ğŸ§© à¤à¤œà¤‚à¤Ÿà¥à¤¸",
      "summarizer": "ğŸ§  à¤¸à¤¾à¤°à¤¾à¤‚à¤¶",
      "jargons": "ğŸ“˜ à¤•à¤¾à¤¯à¤¦à¥‡à¤¶à¥€à¤° à¤¶à¤¬à¥à¤¦à¤¾à¤µà¤²à¥€",
      "timeline": "ğŸ•’ à¤–à¤Ÿà¤²à¥à¤¯à¤¾à¤šà¥€ à¤µà¥‡à¤³à¤°à¥‡à¤–à¤¾",
      "graph": "ğŸ“Š à¤ªà¥à¤°à¤•à¤°à¤£ à¤¸à¤‚à¤¬à¤‚à¤§ à¤—à¥à¤°à¤¾à¤«",
      "thinker": "ğŸ’­ à¤µà¤¿à¤šà¤¾à¤°à¤• (à¤šà¥…à¤Ÿ à¤¸à¤¹à¤¾à¤¯à¥à¤¯à¤•)"
    },
    "Kannada": {
      "agents": "ğŸ§© à²à²œà³†à²‚à²Ÿà³à²—à²³à³",
      "summarizer": "ğŸ§  à²¸à²¾à²°à²¾à²‚à²¶",
      "jargons": "ğŸ“˜ à²•à²¾à²¨à³‚à²¨à³ à²ªà²¦à²—à²³à³",
      "timeline": "ğŸ•’ à²ªà³à²°à²•à²°à²£à²¦ à²µà³‡à²³à²¾à²ªà²Ÿà³à²Ÿà²¿",
      "graph": "ğŸ“Š à²ªà³à²°à²•à²°à²£à²¦ à²¸à²‚à²¬à²‚à²§ à²—à³à²°à²¾à²«à³",
      "thinker": "ğŸ’­ à²šà²¿à²‚à²¤à²• (à²šà²¾à²Ÿà³ à²¸à²¹à²¾à²¯à²•)"
    },
    "Telugu": {
      "agents": "ğŸ§© à°à°œà±†à°‚à°Ÿà±à°²à±",
      "summarizer": "ğŸ§  à°¸à°¾à°°à°¾à°‚à°¶à°‚",
      "jargons": "ğŸ“˜ à°¨à±à°¯à°¾à°¯ à°ªà°¦à°¾à°²à±",
      "timeline": "ğŸ•’ à°•à±‡à°¸à± à°Ÿà±ˆà°®à±â€Œà°²à±ˆà°¨à±",
      "graph": "ğŸ“Š à°•à±‡à°¸à± à°¸à°‚à°¬à°‚à°§ à°—à±à°°à°¾à°«à±",
      "thinker": "ğŸ’­ à°†à°²à±‹à°šà°¨à°•à°°à±à°¤ (à°šà°¾à°Ÿà± à°¸à°¹à°¾à°¯à°•à±à°¡à±)"
    },
    "Tamil": {
      "agents": "ğŸ§© à®®à¯à®•à®µà®°à¯à®•à®³à¯",
      "summarizer": "ğŸ§  à®šà¯à®°à¯à®•à¯à®•à®®à¯",
      "jargons": "ğŸ“˜ à®šà®Ÿà¯à®Ÿà®šà¯ à®šà¯Šà®±à¯à®•à®³à¯",
      "timeline": "ğŸ•’ à®µà®´à®•à¯à®•à®¿à®©à¯ à®•à®¾à®²à®µà®°à®¿à®šà¯ˆ",
      "graph": "ğŸ“Š à®µà®´à®•à¯à®•à¯ à®‰à®±à®µà¯ à®µà®°à¯ˆà®ªà®Ÿà®®à¯",
      "thinker": "ğŸ’­ à®šà®¿à®¨à¯à®¤à®¿à®ªà¯à®ªà®µà®°à¯ (à®…à®°à®Ÿà¯à®Ÿà¯ˆ à®‰à®¤à®µà®¿à®¯à®¾à®³à®°à¯)"
    }
  };

  document.addEventListener("DOMContentLoaded", () => {
    const t = translations[userLanguage] || translations["English"];
    document.querySelector(".sidebar h2").innerText = t.agents;
    document.querySelector('li[data-panel="summary"]').innerText = t.summarizer;
    document.querySelector('li[data-panel="jargons"]').innerText = t.jargons;
    document.querySelector('li[data-panel="timeline"]').innerText = t.timeline;
    document.querySelector('li[data-panel="graph"]').innerText = t.graph;
    document.querySelector('li[data-panel="thinker"]').innerText = t.thinker;

    // Change panel headings too
    document.querySelector("#summary h2").innerText = t.summarizer;
    document.querySelector("#jargons h2").innerText = t.jargons;
    document.querySelector("#timeline h2").innerText = t.timeline;
    document.querySelector("#graph h2").innerText = t.graph;
    document.querySelector("#thinker h2").innerText = t.thinker;
  });
</script>


  <!-- Styles -->
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}" />

  <!-- Markdown & Sanitizer -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/dompurify@3.1.6/dist/purify.min.js"></script>
</head>

<body>
  <!-- ğŸ§­ Sidebar -->
  <div class="sidebar">
    <h2>ğŸ§© Agents</h2>
    <ul>
      <li data-panel="summary" class="active">ğŸ§  Summarizer</li>
      <li data-panel="jargons">ğŸ“˜ Jargons & Terms</li>
      <li data-panel="timeline">ğŸ•’ Timeline</li>
      <li data-panel="graph">ğŸ“Š Graph</li>
      <li data-panel="thinker">ğŸ’­ Thinker</li>
    </ul>
  </div>

  <!-- ğŸ§± Main Content Area -->
  <div class="content">

    <!-- ğŸ§  SUMMARIZER PANEL -->
    <div id="summary" class="panel active">
      <h2>ğŸ§  Summarizer</h2>
      <div id="summary-content"
           class="markdown-box"
           data-md='{{ summary|tojson|safe }}'></div>
      <script>
        document.addEventListener("DOMContentLoaded", () => {
          const summaryEl = document.getElementById("summary-content");
          const md = {{ summary|tojson }};
          summaryEl.innerHTML = marked.parse(md || "Upload a file to begin analysis.");
        });
      </script>
    </div>

    <!-- ğŸ“˜ JARGONS PANEL -->
    <div id="jargons" class="panel">
  <h2>ğŸ“˜ Legal Terms and Jargons</h2>
  <div id="jargon-output" class="markdown-box">âš™ï¸ Extracting...</div>
    </div>

    <script>
    document.addEventListener("DOMContentLoaded", async () => {
      const jargonBox = document.getElementById("jargon-output");
      try {
        const res = await fetch("/api/jargons", { method: "POST" });
        const data = await res.json();
        jargonBox.innerHTML = DOMPurify.sanitize(marked.parse(data.output || "âš ï¸ No terms found."));
      } catch {
        jargonBox.innerHTML = "âš ï¸ Failed to load jargons.";
      }
    });
    </script>

    

    <!-- ğŸ•’ TIMELINE PANEL -->
    <div id="timeline" class="panel">
      <h2>ğŸ•’ Case Timeline</h2>
      <div id="timelineContainer" style="margin-top:20px;"></div>

      <!-- Vis.js Timeline -->
      <link href="https://cdn.jsdelivr.net/npm/vis-timeline@7.7.0/styles/vis-timeline-graph2d.min.css" rel="stylesheet" />
      <script src="https://cdn.jsdelivr.net/npm/vis-timeline@7.7.0/standalone/umd/vis-timeline-graph2d.min.js"></script>
    </div>
    
    <script>
document.addEventListener("DOMContentLoaded", async () => {
  const container = document.getElementById("timelineContainer");
  if (!container) return;

  container.innerHTML = "<p style='color:#aaa;'>ğŸ“„ Extracting timeline...</p>";

  try {
    const res = await fetch("/api/timeline", { method: "POST" });
    const data = await res.json();
    let timelineData = [];

    try {
      timelineData = JSON.parse(data.output);
    } catch {
      console.warn("Timeline parse error:", data.output);
      container.innerHTML = "<p>âš ï¸ Invalid timeline data.</p>";
      return;
    }

    if (!Array.isArray(timelineData) || timelineData.length === 0) {
      container.innerHTML = "<p>âš ï¸ No timeline events found.</p>";
      return;
    }

   // âœ… FIXED TIMELINE CODE
const items = new vis.DataSet(
  timelineData.map((e, i) => {
    const isStage = e.date && e.date.toLowerCase().includes("stage");
    
    // Create a sequential placeholder date if it's a stage (e.g., Jan 1 2000 â†’ Jan 2 2000 â†’ â€¦)
    const startDate = isStage
      ? new Date(2000, 0, parseInt(e.date.replace(/\D/g, ""), 10) || i + 1)
      : new Date(e.date); // fallback to actual date if valid

    return {
      id: i + 1,
      content: `<b>${e.title}</b><br>${e.description}`,
      start: startDate
    };
  })
);



    const options = {
  orientation: "top",
  zoomable: true,
  moveable: true,
  width: "100%",
  height: "500px",
  margin: { item: 15 },
  selectable: false,
  tooltip: { followMouse: true },
  timeAxis: { scale: "day", step: 1 },
  showCurrentTime: false
};


    new vis.Timeline(container, items, options);
  } catch (err) {
    console.error(err);
    container.innerHTML = "<p>âš ï¸ Failed to generate timeline.</p>";
  }
});
</script>

    <div id="graph" class="panel">
    <h2>ğŸ“Š Case Relationship Graph</h2>
    <div id="graphContainer" style="width:100%; height:600px; margin-top:20px;"></div>
    <script src="https://d3js.org/d3.v7.min.js"></script>
  </div>



    <!-- ğŸ’­ THINKER CHAT PANEL -->
    <div id="thinker" class="panel">
      <h2>ğŸ’­ Thinker (Chat Agent)</h2>
      <div id="chat-box" class="chat-box"></div>
      <div class="chat-input">
        <textarea id="user-input" placeholder="Ask anything about your case or position..."></textarea>
        <button id="sendBtn">Send</button>
      </div>
    </div>

  </div> <!-- âœ… CLOSES .content -->

  <!-- JS Logic -->
  <script src="{{ url_for('static', filename='app.js') }}"></script>
</body>
</html>
